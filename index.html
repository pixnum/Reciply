<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Recipe Generator - Manik Roy 2025</title>
<style>
  :root {
    --color-bg-light: #fafafa;
    --color-text-light: #222;
    --color-bg-dark: #121212;
    --color-text-dark: #eee;
    --color-primary: #4CAF50;
    --color-accent: #ff9800;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--color-bg-light);
    color: var(--color-text-light);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark {
    background-color: var(--color-bg-dark);
    color: var(--color-text-dark);
  }

  main {
    max-width: 600px;
    width: 100%;
    text-align: center;
  }

  h1 {
    margin-bottom: 0.2em;
  }

  label {
    display: block;
    margin: 1em 0 0.3em;
    font-weight: 600;
  }

  input[type="text"] {
    width: 80%;
    max-width: 400px;
    padding: 0.5em;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    outline-offset: 2px;
  }
  body.dark input[type="text"] {
    background-color: #333;
    border: 1px solid #555;
    color: var(--color-text-dark);
  }

  button {
    margin: 1em 0.3em;
    padding: 0.6em 1.2em;
    font-size: 1rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background-color: var(--color-primary);
    color: white;
    transition: background-color 0.3s;
  }
  button:hover, button:focus {
    background-color: #388e3c;
    outline: none;
  }

  button.secondary {
    background-color: var(--color-accent);
  }
  button.secondary:hover, button.secondary:focus {
    background-color: #f57c00;
  }

  .recipe-list, .favorites-list {
    margin-top: 1em;
    text-align: left;
  }

  .recipe-item {
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-bottom: 1em;
    padding: 1em;
    background-color: #f9f9f9;
  }
  body.dark .recipe-item {
    background-color: #222;
    border-color: #444;
  }

  .recipe-item h3 {
    margin-top: 0;
  }

  .ingredients-list {
    margin: 0.3em 0 0.8em 1em;
  }

  .instructions {
    white-space: pre-wrap;
  }

  .flex-row {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 1em;
  }

  .portion-input {
    width: 80px;
    padding: 0.4em;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  body.dark .portion-input {
    background-color: #333;
    border: 1px solid #555;
    color: var(--color-text-dark);
  }

  .toggle-switch {
    position: fixed;
    top: 1em;
    right: 1em;
    user-select: none;
  }

  footer {
    margin-top: auto;
    padding: 1em 0;
    text-align: center;
    font-size: 0.9rem;
    color: #888;
  }
  body.dark footer {
    color: #bbb;
  }

  @media (max-width: 600px) {
    input[type="text"] {
      width: 100%;
      max-width: none;
    }
  }
</style>
</head>
<body>
  <div class="toggle-switch" title="Toggle Dark Mode">
    <label>
      <input type="checkbox" id="darkModeToggle" aria-label="Toggle dark mode" />
      ðŸŒ™ Dark Mode
    </label>
  </div>
  <main>
    <h1>Recipe Generator</h1>
    <p>Enter ingredients you have (comma separated):</p>
    <input type="text" id="ingredientsInput" placeholder="e.g. chicken, rice, tomato" aria-label="Enter ingredients" />
    <div class="flex-row" style="justify-content:center;">
      <button id="generateBtn">Generate Recipes</button>
      <button id="showFavBtn" class="secondary">Show Favorites</button>
    </div>

    <div id="portionControl" style="display:none; margin-top:1em;">
      <label for="portionInput">Adjust Portions:</label>
      <input type="number" id="portionInput" min="1" value="1" class="portion-input" aria-label="Adjust portions" />
    </div>

    <div id="recipes" class="recipe-list" aria-live="polite" aria-atomic="true"></div>
    <div id="favorites" class="favorites-list" style="display:none;" aria-live="polite" aria-atomic="true"></div>
  </main>
  <footer>Â© Manik Roy 2025</footer>

<script>
  (() => {
    // Sample recipe database
    const recipes = [
      {
        id: 1,
        name: "Tomato Rice",
        ingredients: ["rice", "tomato", "onion", "garlic", "oil", "salt"],
        instructions: "1. Heat oil, sautÃ© onion and garlic.\n2. Add chopped tomato and cook till soft.\n3. Add rice and salt.\n4. Add water, cook covered till rice is done.",
        servings: 2,
      },
      {
        id: 2,
        name: "Chicken Stir Fry",
        ingredients: ["chicken", "soy sauce", "bell pepper", "onion", "oil", "garlic", "salt"],
        instructions: "1. Cut chicken into strips.\n2. Heat oil, sautÃ© garlic and onion.\n3. Add chicken, cook till browned.\n4. Add bell pepper and soy sauce.\n5. Stir fry till cooked through.",
        servings: 3,
      },
      {
        id: 3,
        name: "Vegetable Omelette",
        ingredients: ["eggs", "tomato", "onion", "bell pepper", "salt", "pepper", "oil"],
        instructions: "1. Beat eggs with salt and pepper.\n2. Heat oil, sautÃ© vegetables.\n3. Pour eggs, cook until set.\n4. Fold and serve.",
        servings: 1,
      },
      {
        id: 4,
        name: "Pasta with Tomato Sauce",
        ingredients: ["pasta", "tomato", "garlic", "olive oil", "salt", "basil"],
        instructions: "1. Boil pasta.\n2. Heat olive oil, sautÃ© garlic.\n3. Add tomato, cook into sauce.\n4. Mix pasta with sauce.\n5. Garnish with basil.",
        servings: 2,
      },
      {
        id: 5,
        name: "Fruit Salad",
        ingredients: ["apple", "banana", "orange", "grapes", "honey", "lemon juice"],
        instructions: "1. Chop all fruits.\n2. Mix honey and lemon juice.\n3. Toss fruits with dressing.\n4. Chill and serve.",
        servings: 4,
      }
    ];

    // DOM elements
    const ingredientsInput = document.getElementById('ingredientsInput');
    const generateBtn = document.getElementById('generateBtn');
    const recipesDiv = document.getElementById('recipes');
    const portionControl = document.getElementById('portionControl');
    const portionInput = document.getElementById('portionInput');
    const favoritesDiv = document.getElementById('favorites');
    const showFavBtn = document.getElementById('showFavBtn');
    const darkModeToggle = document.getElementById('darkModeToggle');

    // State
    let currentRecipes = [];
    let currentPortion = 1;
    let showingFavorites = false;

    // Utility: Normalize strings (lowercase, trim)
    function normalize(str) {
      return str.trim().toLowerCase();
    }

    // Find matching recipes based on ingredients
    function findRecipes(availableIngredients) {
      const availableSet = new Set(availableIngredients.map(normalize));
      // Match recipe if ALL recipe ingredients are in availableSet (relaxed: allow if at least half ingredients match)
      return recipes.filter(recipe => {
        let matchedCount = 0;
        for (const ing of recipe.ingredients) {
          if (availableSet.has(normalize(ing))) matchedCount++;
        }
        // Require at least half ingredients to be available
        return matchedCount >= Math.ceil(recipe.ingredients.length / 2);
      });
    }

    // Render recipes list
    function renderRecipes(recipesToShow) {
      favoritesDiv.style.display = 'none';
      recipesDiv.style.display = 'block';
      portionControl.style.display = recipesToShow.length ? 'block' : 'none';

      if (!recipesToShow.length) {
        recipesDiv.innerHTML = '<p>No recipes match your ingredients.</p>';
        return;
      }

      let html = '';
      recipesToShow.forEach(recipe => {
        const servings = currentPortion;
        const scale = servings / recipe.servings;

        // Scale ingredients
        const scaledIngredients = recipe.ingredients.map(ing => {
          // Since no quantities in sample data, just display ingredient name
          return ing;
        });

        // Check if favorite
        const favs = getFavorites();
        const isFav = favs.some(f => f.id === recipe.id);

        html += `
          <div class="recipe-item" tabindex="0" aria-label="Recipe: ${recipe.name}">
            <h3>${recipe.name}</h3>
            <strong>Ingredients:</strong>
            <ul class="ingredients-list">${scaledIngredients.map(ing => `<li>${ing}</li>`).join('')}</ul>
            <strong>Instructions:</strong>
            <p class="instructions">${recipe.instructions}</p>
            <p><em>Servings: ${servings}</em></p>
            <button aria-pressed="${isFav}" class="fav-btn" data-id="${recipe.id}" aria-label="${isFav ? 'Remove from favorites' : 'Add to favorites'}">
              ${isFav ? 'â˜… Remove Favorite' : 'â˜† Add to Favorites'}
            </button>
          </div>
        `;
      });

      recipesDiv.innerHTML = html;

      // Attach event handlers to favorite buttons
      document.querySelectorAll('.fav-btn').forEach(btn => {
        btn.onclick = () => {
          const id = Number(btn.getAttribute('data-id'));
          toggleFavorite(id);
          renderRecipes(currentRecipes); // Re-render to update favorite buttons
        };
      });
    }

    // Render favorites list
    function renderFavorites() {
      recipesDiv.style.display = 'none';
      portionControl.style.display = 'none';
      favoritesDiv.style.display = 'block';

      const favs = getFavorites();

      if (!favs.length) {
        favoritesDiv.innerHTML = '<p>You have no favorite recipes saved.</p>';
        return;
      }

      let html = '<h2>Your Favorites</h2>';
      favs.forEach(recipe => {
        html += `
          <div class="recipe-item" tabindex="0" aria-label="Favorite Recipe: ${recipe.name}">
            <h3>${recipe.name}</h3>
            <strong>Ingredients:</strong>
            <ul class="ingredients-list">${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>
            <strong>Instructions:</strong>
            <p class="instructions">${recipe.instructions}</p>
            <p><em>Servings: ${recipe.servings}</em></p>
            <button aria-pressed="true" class="fav-btn" data-id="${recipe.id}" aria-label="Remove from favorites">
              â˜… Remove Favorite
            </button>
          </div>
        `;
      });

      favoritesDiv.innerHTML = html;

      // Attach event handlers to remove favorite buttons
      document.querySelectorAll('.fav-btn').forEach(btn => {
        btn.onclick = () => {
          const id = Number(btn.getAttribute('data-id'));
          toggleFavorite(id);
          renderFavorites(); // Re-render favorites
        };
      });
    }

    // Local Storage favorites management
    function getFavorites() {
      try {
        const favs = localStorage.getItem('recipeFavorites');
        if (favs) return JSON.parse(favs);
      } catch {
        return [];
      }
      return [];
    }
    function saveFavorites(favs) {
      localStorage.setItem('recipeFavorites', JSON.stringify(favs));
    }
    function toggleFavorite(id) {
      const favs = getFavorites();
      const index = favs.findIndex(r => r.id === id);
      if (index > -1) {
        favs.splice(index, 1);
      } else {
        const recipe = recipes.find(r => r.id === id);
        if (recipe) favs.push(recipe);
      }
      saveFavorites(favs);
    }

    // Event handlers
    generateBtn.addEventListener('click', () => {
      const input = ingredientsInput.value;
      if (!input.trim()) {
        alert('Please enter some ingredients first.');
        return;
      }
      const inputIngredients = input.split(',').map(i => i.trim()).filter(Boolean);
      currentRecipes = findRecipes(inputIngredients);
      currentPortion = 1;
      portionInput.value = 1;
      showingFavorites = false;
      renderRecipes(currentRecipes);
    });

    portionInput.addEventListener('input', () => {
      let val = Number(portionInput.value);
      if (isNaN(val) || val < 1) {
        val = 1;
        portionInput.value = 1;
      }
      currentPortion = val;
      if (!showingFavorites) renderRecipes(currentRecipes);
    });

    showFavBtn.addEventListener('click', () => {
      showingFavorites = !showingFavorites;
      if (showingFavorites) {
        showFavBtn.textContent = 'Show Recipes';
        renderFavorites();
      } else {
        showFavBtn.textContent = 'Show Favorites';
        renderRecipes(currentRecipes);
      }
    });

    // Dark mode toggle & persistence
    function loadDarkMode() {
      const saved = localStorage.getItem('darkModeEnabled');
      if (saved === 'true') {
        document.body.classList.add('dark');
        darkModeToggle.checked = true;
      } else {
        document.body.classList.remove('dark');
        darkModeToggle.checked = false;
      }
    }
    darkModeToggle.addEventListener('change', () => {
      if (darkModeToggle.checked) {
        document.body.classList.add('dark');
        localStorage.setItem('darkModeEnabled', 'true');
      } else {
        document.body.classList.remove('dark');
        localStorage.setItem('darkModeEnabled', 'false');
      }
    });

    // Initialize
    loadDarkMode();

  })();
</script>
</body>
</html>
